!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t,e=1){this.url=t,this.scale=e}init(){return this.setImg().then(t=>(console.log(t),this.setCacheImg(),this.setImgData(),"Created cached image and got its data")).catch(t=>console.log(t))}setImg(){return new Promise((t,e)=>{this.img=new Image,this.img.src=this.url,this.img.onload=(e=>t(`"${this.img.src}" loaded`)),this.img.onerror=(t=>e(`Error loading "${this.img.src}"`))})}setCacheImg(){let t,e;const i=this.img.height/this.img.width;window.innerHeight/window.innerWidth<i?(e=window.innerHeight,t=window.innerHeight/i):(t=window.innerWidth,e=window.innerWidth*i),this.cacheCtx=Object.assign(document.createElement("canvas"),{width:t,height:e}).getContext("2d")}setImgData(){this.cacheCtx.drawImage(this.img,0,0,this.width,this.height),this.imgData=this.cacheCtx.getImageData(0,0,this.width,this.height)}get width(){return this.cacheCtx.canvas.width}get height(){return this.cacheCtx.canvas.height}get pixelData(){return this.imgData.data}}class n{constructor({url:t,scale:e=1,columns:i,rows:n}){this.columns=i,this.rows=n,this.cachedImg=new s(t,e)}init(){return this.cachedImg.init().then(t=>(console.log(t),this.setCellDimensions(),this.setMatrix(),"Created matrix image"))}setCellDimensions(){this.cellWidth=Math.ceil(this.cachedImg.width/this.columns),this.cellHeight=Math.ceil(this.cachedImg.height/this.rows)}setMatrix(){this.matrix=Array.from({length:this.rows},(t,e)=>Array.from({length:this.columns},(t,i)=>({color:this.getPixelRGB(this.getPixel(e,i)),origin:{x:i*this.cellWidth,y:e*this.cellHeight}})))}getPixel(t,e){const i=4*(e*this.cellWidth+t*this.cellHeight*this.cachedImg.width);return this.cachedImg.pixelData.slice(i,i+4)}getPixelRGB(t){return`rgb(${t[0]}, ${t[1]}, ${t[2]})`}update(t,e){t&&(this.columns=t),e&&(this.rows=e),this.setCellDimensions(),this.setMatrix()}}function h(t,e=null,i=null){const s=document.createElement(t);return e&&o(s,e),i&&l(s,i),s}function a(t,e=null,i=null){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&o(s,e),i&&l(s,i),s}function o(t,e){Object.keys(e).forEach(i=>{switch(i){case"classes":e[i].forEach(e=>t.classList.add(e));break;case"textContent":t.textContent=e[i];break;case"selected":t.selected=e[i];default:t.setAttribute(i,e[i])}})}function l(t,e){e.forEach(e=>t.appendChild(e))}class r{constructor({parent:t,title:e,content:i}){this.title=e,this.content=i,this.node=null,this.parent=t,this.render()}render(){this.node=h("div",{id:"description"},[h("h1",{textContent:this.title},null)]),this.content.forEach(t=>{const e=h("p",{textContent:t},null);this.node.appendChild(e)}),this.parent.node.appendChild(this.node)}}class d{constructor({parent:t,prop:e,scope:i=null,updateFn:s=null,label:n,options:h,value:a}){this.prop=e,this.scope=i,this.updateFn=s,this.label=n,this.options=h,this.value=a,this.parent=t,this.node=null,this.input=null,this.render(),this.eventListener()}render(){const t=this.options.map(t=>h("option",{value:t,textContent:t,selected:t===this.value}));this.input=h("select",{id:this.prop},t),this.node=h("div",{classes:["select"]},[h("label",{textContent:this.label,for:this.prop},null),h("br"),this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){this.value=this.input.value,this.scope?this.scope[this.prop]=this.value:this.parent.scope[this.prop]=this.value,this.updateFn?this.updateFn():this.parent.updateFn()}}class c{constructor({parent:t,label:e,scopeOptions:i,updateFn:s=null,type:n="image"}){this.scopeOptions=i,this.updateFn=s,this.type=n,this.label=e,this.parent=t,this.node=null,this.input=null,this.render(),this.eventListener()}render(){this.input=h("input",{type:"file"},null),this.node=h("label",{textContent:this.label,id:this.label.replace(/\s/g,"-"),classes:["file-btn"]},[this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){const e=new FileReader;e.onload=(t=>{const e="json"===this.type?JSON.parse(t.target.result):t.target.result,i=this.scopeOptions?{[this.scopeOptions]:e}:e;this.updateFn?this.updateFn(i):this.parent.updateFn(i)}),"image"===this.type&&e.readAsDataURL(t.target.files[0]),"json"===this.type&&e.readAsText(t.target.files[0])}}class p{constructor({parent:t,label:e,fn:i}){this.fn=i,this.label=e,this.parent=t,this.node=null,this.render(),this.eventListener()}render(){this.node=h("button",{textContent:this.label,id:this.label.replace(/\s/g,"-")},null),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.fn()}}class u{constructor({parent:t,max:e,min:i,step:s=1,value:n,prop:h,scope:a=null,updateFn:o=null,label:l}){this.prop=h,this.scope=a,this.updateFn=o,this.label=l,this.max=e,this.min=i,this.step=s,this.value=n,this.parent=t,this.node=null,this.input=null,this.output=null,this.render(),this.eventListener()}render(){this.input=h("input",{type:"range",id:this.prop,max:this.max,min:this.min,step:this.step,value:this.value}),this.output=h("output",{textContent:this.value}),this.node=h("div",{classes:["slider"]},[h("label",{for:this.prop,textContent:`${this.label} â€” `}),this.output,h("br"),this.input]),this.parent.node.appendChild(this.node)}eventListener(){this.input.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){const e=this.input.valueAsNumber;this.output.textContent=e,this.scope?this.scope[this.prop]=e:this.parent.scope[this.prop]=e,this.updateFn?this.updateFn():this.parent.updateFn()}}class g{constructor({parent:t,prop:e,scope:i=null,updateFn:s=null,value:n,label:h}){this.prop=e,this.scope=i,this.updateFn=s,this.label=h,this.value=n,this.node=null,this.parent=t,this.render(),this.eventListener()}render(){this.node=h("button",{textContent:this.label,id:this.prop,classes:["toggle"]},null),this.value||this.node.classList.add("deactivated"),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.node.classList.toggle("deactivated"),this.value=!this.value,this.scope?this.scope[this.prop]=this.value:this.parent.scope[this.prop]=this.value,this.updateFn?this.updateFn():this.parent.updateFn()}}class m{constructor({parent:t,fn:e,updateFn:i=null,label:s}){this.fn=e,this.updateFn=i,this.label=s,this.node=null,this.parent=t,this.render(),this.eventListener()}render(){this.node=h("button",{textContent:this.label,id:this.label.replace(/\s/g,"-")},null),this.parent.node.appendChild(this.node)}eventListener(){this.node.addEventListener("click",this.eventHandler.bind(this))}eventHandler(t){this.fn(),this.updateFn?this.updateFn():this.parent.updateFn()}}class v{constructor({parent:t,select:e,emptyMessage:i="No options"}){this.emptyMessage=i,this.select=e.input,this.selectValue=this.select.value,this.parent=t,this.node=null,this.updateFn=this.parent.updateFn,this.scope=this.parent.scope,this.groups={},this.render(),this.eventListener()}createGroup({name:t,nodes:e}){const i=h("div",{id:`section-${t}`},e.map(t=>t.node));this.groups[t]=i,this.render()}render(){this.groups[this.selectValue]||(this.groups[this.selectValue]=h("div",{classes:["section-empty"]},[h("p",{textContent:this.emptyMessage})])),this.node?this.node.replaceChild(this.groups[this.selectValue],this.node.firstElementChild):(this.node=h("div",{classes:["section-container"]},[this.groups[this.selectValue]]),this.parent.node.appendChild(this.node))}eventListener(){this.select.addEventListener("change",this.eventHandler.bind(this))}eventHandler(t){this.selectValue=this.select.value,this.render()}}class b{constructor({showOnLoad:t=!0,updateFn:e,scope:i}){this.showOnLoad=t,this.updateFn=e,this.scope=i,this.componentTypes={description:r,select:d,toggleButton:g,slider:u,fileButton:c,downloadButton:p,section:v,button:m},this.node=null,this.menuBtn=null,this.closeBtn=null,this.reset(),this.render(),this.eventListener()}reset(){const t=document.querySelector("#ui"),e=document.querySelector("#menu");t&&t.parentNode.removeChild(t),e&&e.parentNode.removeChild(e)}createComponent(t,e=null){return e.parent||(e=Object.assign({},{parent:this},e)),new this.componentTypes[t](e)}render(){this.menuBtn=a("svg",{width:45,height:45,id:"menu"},[a("rect",{x:10,y:10,width:25,height:5,fill:"#000"}),a("rect",{x:10,y:20,width:25,height:5,fill:"#000"}),a("rect",{x:10,y:30,width:25,height:5,fill:"#000"})]),this.closeBtn=h("button",{textContent:"[ close ]",id:"close"},null),this.node=h("div",{id:"ui"},[this.closeBtn]),this.showOnLoad||this.node.classList.add("moverIzq"),document.body.appendChild(this.menuBtn),document.body.appendChild(this.node)}addSeparator(){const t=document.createElement("hr");this.node.appendChild(t)}eventListener(){this.menuBtn.addEventListener("click",this.openEventHandler.bind(this)),this.closeBtn.addEventListener("click",this.closeEventHandler.bind(this))}openEventHandler(t){this.node.classList.remove("moverIzq")}closeEventHandler(t){this.node.classList.add("moverIzq")}addSignature(){const t=a("svg",{width:50,height:50,viewBox:"0 0 13.229166 13.229167"},[a("rect",{y:"-7.7716e-16",width:"13.229",height:"13.229",fill:"#aaa",style:"paint-order:normal"},null),a("g",{fill:"#fff"},[a("path",{d:"m5.7496 1.641v6.8601c0 0.75774-0.61427 1.372-1.372 1.372-0.63771 0-1.174-0.43495-1.3278-1.0245l-1.2898 1.2898c0.54581 0.87079 1.514 1.4497 2.6176 1.4497 1.7049 0 3.087-1.3821 3.087-3.0871v-6.8601z"},null),a("path",{d:"m8.3907 5.4141v6.1741c1.701-5e-3 3.0785-1.385 3.0785-3.0871 0-1.7021-1.3775-3.0824-3.0785-3.087z"},null),a("path",{d:"m8.3907 1.641v3.43c0.94414-4e-3 1.7084-0.77004 1.7084-1.715s-0.76428-1.7115-1.7084-1.715z"},null)])]),e=h("a",{href:"https://github.com/jblanper",target:"_blank",id:"signature"},[h("span",{textContent:"by"}),t]);this.node.appendChild(e)}}class x{constructor(t,e){this._ctx=t,this.options=e}init({imageUrl:t=this.options.imageUrl,scale:e=this.options.scale,columns:i=this.options.columns,rows:s=this.options.rows}={}){return this.imageMatrix=new n({url:t,scale:e,columns:i,rows:s}),this.imageMatrix.init().then(t=>(console.log(t),this._ctx.canvas.height=this.imageMatrix.cachedImg.height,this._ctx.canvas.width=this.imageMatrix.cachedImg.width,this.setBindings(),this.draw(),"Sketch initialized"))}setBindings(){const t=new b({showOnLoad:!0,updateFn:t=>{this.update(),this.draw()},scope:this});t.createComponent("description",{title:"Pixelator",content:["This web turns any photo into a complex tessellations.","Change the number of columns and rows of the tessellation                 with the sliders. A new image from a local device can  \n                be locally loaded. No data goes to no server. Enjoy!"]}),t.addSeparator();t.createComponent("slider",{prop:"columns",label:"columns",scope:this.imageMatrix,max:this.imageMatrix.cachedImg.width/7,min:2,value:this.imageMatrix.columns}),t.createComponent("slider",{prop:"rows",label:"rows",scope:this.imageMatrix,max:this.imageMatrix.cachedImg.height/7,min:4,value:this.imageMatrix.rows});t.addSeparator(),t.createComponent("fileButton",{scopeOptions:"imageUrl",updateFn:this.init.bind(this),label:"upload IMG"}),t.createComponent("downloadButton",{fn:this.setPng.bind(this),label:"download IMG"}),t.addSignature()}setPng(){const t=Object.assign(document.createElement("canvas"),{width:this._ctx.canvas.width,height:this._ctx.canvas.height}).getContext("2d");return t.drawImage(this._ctx.canvas,0,0),t.canvas.toDataURL("image/png")}draw(){this.imageMatrix.matrix.forEach(t=>t.forEach(t=>{this._ctx.fillStyle=t.color,this._ctx.fillRect(t.origin.x,t.origin.y,this.imageMatrix.cellWidth,this.imageMatrix.cellHeight)}))}update(){this.imageMatrix.update()}}const w={canvas:{},sketch:{backgroundColor:"white",imageUrl:"./photo.jpg",scale:1,columns:5,rows:15}};!function(){const t=document.querySelector("canvas").getContext("2d");new x(t,w.sketch).init().then(t=>console.log(t)).catch(t=>console.log(t))}()}]);